{% extends 'Student/base.html' %}

{% block content %}

<div class="container">
    <h1>Create Question</h1>
    {% if error %}
         <p style="color: red;">{{ error }}</p>
    {% endif %}
    <form id="question-form" method="post">
        {% csrf_token %}
        {{ question_form.as_p }}
        <div id="options_formset">
            {{ formset.management_form }}
            {% for form in formset %}
                <div class="option-form">
                    {{ form.as_p }}
                    <button type="button" class="remove-option">Remove</button>
                </div>
            {% endfor %}
        </div>
        <button type="button" id="add-option">Add Option</button>
        <button type="submit">Save</button>
    </form>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    let optionForms = document.querySelectorAll(".option-form");
    let container = document.querySelector("#options_formset");
    let addButton = document.querySelector("#add-option");
    let totalForms = document.querySelector("#id_options-TOTAL_FORMS");

    if (!totalForms) {
        console.error("Element with id 'id_options-TOTAL_FORMS' not found.");
        return;
    }

    let formNum = optionForms.length - 1;
    addButton.addEventListener('click', addForm);

    function addForm(e) {
        e.preventDefault();

        let newForm = optionForms[0].cloneNode(true);
        let formRegex = /options-(\d+)-/g;

        formNum++;
        newForm.innerHTML = newForm.innerHTML.replace(formRegex, `options-${formNum}-`);

        // Update the ID and name attributes of the new form fields
        let formFields = newForm.querySelectorAll('input, select, textarea, label');
        formFields.forEach(function(field) {
            if (field.id) {
                console.log(`Updating field id from ${field.id} to ${field.id.replace(formRegex, `options-${formNum}-`)}`);
                field.id = field.id.replace(formRegex, `options-${formNum}-`);
            }
            if (field.name) {
                console.log(`Updating field name from ${field.name} to ${field.name.replace(formRegex, `options-${formNum}-`)}`);
                field.name = field.name.replace(formRegex, `options-${formNum}-`);
            }
            if (field.htmlFor) { // Update label 'for' attributes
                console.log(`Updating label for from ${field.htmlFor} to ${field.htmlFor.replace(formRegex, `options-${formNum}-`)}`);
                field.htmlFor = field.htmlFor.replace(formRegex, `options-${formNum}-`);
            }
        });

        // Add remove button event listener
        newForm.querySelector('.remove-option').addEventListener('click', removeForm);

        container.appendChild(newForm);

        totalForms.setAttribute('value', `${formNum + 1}`);
    }

    function removeForm(e) {
        e.preventDefault();
        let formToRemove = e.target.closest('.option-form');
        formToRemove.remove();

        // Update total forms count
        let currentForms = document.querySelectorAll('.option-form').length;
        totalForms.setAttribute('value', `${currentForms}`);
    }

    // Add remove event listeners to initial forms
    optionForms.forEach(function(form) {
        form.querySelector('.remove-option').addEventListener('click', removeForm);
    });
});
</script>

<style>
    body {
        background-color: #f8f9fa;
        font-family: 'Arial', sans-serif;
    }

    .container {
        max-width: 800px;
        padding: 30px;
        background-color: #ffffff;
        border: 1px solid #e9ecef;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-top: 50px;
    }

    h1 {
        color: #343a40;
        font-size: 2.5rem;
        font-weight: 700;
        text-align: center;
        margin-bottom: 30px;
    }

    .form-control {
        padding: 10px;
        font-size: 1rem;
        border-radius: 5px;
        border: 1px solid #ced4da;
    }

    .btn-primary {
        background-color: #007bff;
        border: none;
        padding: 10px 20px;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 5px;
    }

    .btn-primary:hover {
        background-color: #0069d9;
    }

    .btn-secondary {
        background-color: #6c757d;
        border: none;
        padding: 10px 20px;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 5px;
        margin-bottom: 20px;
    }

    .btn-secondary:hover {
        background-color: #5a6268;
    }

    .btn-danger {
        background-color: #dc3545;
        border: none;
        padding: 5px 10px;
        font-size: 0.875rem;
        font-weight: 600;
        border-radius: 5px;
    }

    .btn-danger:hover {
        background-color: #c82333;
    }

    .option-form {
        border: 1px solid #e9ecef;
        border-radius: 5px;
        padding: 15px;
        background-color: #f1f1f1;
        margin-bottom: 10px;
    }
</style>

{% endblock %}
